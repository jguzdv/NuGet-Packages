@namespace JGUZDV.Blazor.Components.JGOO.Sidebar
@using Microsoft.AspNetCore.Components.Routing
@using JGUZDV.Blazor.Components.JGOO

@if (ChildContent != null)
{
    <span class="nav-link disabled @GetPadding() @(Context.NestingLevel > 0 ? "header-navigation-sidebar" : "")">
        @if (Icon != null)
        {
            @Icon
        }
        @Name
    </span>
    <CascadingValue Value="@GetNestedContext()">
        <div class="nav flex-column border-left border-1">
            @ChildContent
        </div>
    </CascadingValue>
}
else
{
    <NavLink class="@NavLinkClass" href="@NavUrl" Match="@Match" data-sidebar-close>
        @if (Icon != null)
        {
            @Icon
        }
        <span class="nav-title">@Name</span>
    </NavLink>
}

@* Only render separator after top-level items *@
@if ((Context?.NestingLevel ?? 0) == 0)
{
    <hr />
}

@code {
    [CascadingParameter, EditorRequired]
    public required NavRenderContext Context { get; set; }

    [Parameter, EditorRequired]
    public required string Name { get; set; }

    [Parameter]
    public string? NavUrl { get; set; }

    [Parameter]
    public RenderFragment? Icon { get; set; }

    [Parameter]
    public NavLinkMatch Match { get; set; } = NavLinkMatch.Prefix;

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        if (!string.IsNullOrWhiteSpace(NavUrl) && ChildContent != null)
        {
            throw new InvalidOperationException($"Ein Navigationseintrag darf entweder eine URL oder Children besitzen, aber nicht beides. Fehler bei: '{Name}'");
        }
    }

    private NavRenderContext GetNestedContext()
    {
        if (Context == null)
        {
            return NavRenderContext.CreateNestedContext(NavRenderContext.CreateRootContext());
        }

        return NavRenderContext.CreateNestedContext(Context);
    }

    private string GetPadding() => ($"ps-{Context.NestingLevel + 1}");

    private string NavLinkClass => $"nav-link header-navigation-sidebar {GetPadding()}";
}