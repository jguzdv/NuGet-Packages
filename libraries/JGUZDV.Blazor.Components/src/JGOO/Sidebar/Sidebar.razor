@using Microsoft.AspNetCore.Components.Routing

<aside id="jbs-sidebar" class="jbs-sidebar @AdditionalClasses">

    @ChildContent

    @if (NavItems != null)
    {
        <div class="nav flex-column mt-3">
            <CascadingValue Value="@_navRenderContext">
                @NavItems
            </CascadingValue>
        </div>
    }
    else if (NavigationContent != null && NavigationContent.Count > 0)
    {
        <div class="nav flex-column mt-3">
            @foreach (var navItem in NavigationContent)
            {
                @if (navItem.HasChildren)
                {
                    <span class="nav-link disabled">@navItem.Name</span>
                    @foreach (var child in navItem.Children!)
                    {
                        <NavLink class="nav-link header-navigation-sidebar" href="@child.NavUrl" Match="@child.Match" data-sidebar-close>
                            @if (child.Icon != null)
                            {
                                @child.Icon
                            }
                            <span class="nav-title">@child.Name</span>
                        </NavLink>
                    }

                }
                else
                {
                    <NavLink class="nav-link header-navigation-sidebar" href="@navItem.NavUrl" Match="@navItem.Match" data-sidebar-close>
                        @if (navItem.Icon != null)
                        {
                            @navItem.Icon
                        }
                        <span class="nav-title">@navItem.Name</span>
                    </NavLink>
                }
            <hr />
            }
        </div>
    }

</aside>

@code {
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public string? AdditionalClasses { get; set; }

    [Parameter]
    public RenderFragment? NavItems { get; set; }

    [Parameter]
    [Obsolete($"Use {nameof(NavItems)} parameter with {nameof(SidebarNavItem)} components instead. This will be removed in a future version.")]
    public List<NavigationSpecs>? NavigationContent { get; set; }

    private readonly NavRenderContext _navRenderContext = NavRenderContext.CreateRootContext();

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        if (NavItems != null && NavigationContent != null)
        {
            throw new InvalidOperationException($"Either {nameof(NavItems)} or {nameof(NavigationContent)} may be set, but not both.");
        }

        if (NavigationContent != null)
        {
            foreach (var item in NavigationContent)
            {
                if (!string.IsNullOrWhiteSpace(item.NavUrl) && item.HasChildren)
                {
                    throw new InvalidOperationException($"Ein Navigationseintrag darf entweder eine URL oder Children besitzen, aber nicht beides. Fehler bei: '{item.Name}'");
                }
            }
        }
    }
}