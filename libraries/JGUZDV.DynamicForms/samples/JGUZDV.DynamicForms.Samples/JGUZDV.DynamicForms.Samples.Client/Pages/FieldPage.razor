@page "/field"
@using JGUZDV.DynamicForms.Model
@using System.Text.Json
@using JGUZDV.DynamicForms.Serialization
@using JGUZDV.L10n


<h1>Field</h1>

@foreach (var field in _fields)
{
    <JGUZDV.DynamicForms.Blazor.FieldInput Field="field" />
}

<button @onclick="Save">Save</button>

@code {
    private List<Field> _fields = new List<Field>();

    protected override async Task OnInitializedAsync()
    {
        var client = new HttpClient();
        var options = new JsonSerializerOptions()
            {
                TypeInfoResolver = new DefaultResolver(),
            };
        options.Converters.Add(new L10nStringJsonConverter());

        _fields = (await client.GetFromJsonAsync<List<FieldDefinition>>("https://localhost:7245/api/definitions", options))
            .Select(x => new Field(x))
            .ToList();
    }

    private async Task Save()
    {
        var client = new HttpClient();
        var options = new JsonSerializerOptions()
            {
                TypeInfoResolver = new DefaultResolver(),
            };
        options.Converters.Add(new L10nStringJsonConverter());
        await client.PostAsJsonAsync("https://localhost:7245/api/documents/save", _fields);
    }
}
